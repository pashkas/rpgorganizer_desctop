<Window
    x:Class="Sample.View.AddOrEditAbilityView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ViewModel="clr-namespace:Sample.ViewModel"
    xmlns:behavior="clr-namespace:Sample.Behavior"
    xmlns:behavior1="clr-namespace:DotNetLead.DragDrop.UI.Behavior"
    xmlns:componentModel="clr-namespace:System.ComponentModel;assembly=WindowsBase"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ei="http://schemas.microsoft.com/expression/2010/interactions"
    xmlns:generic="clr-namespace:System.Collections.Generic;assembly=mscorlib"
    xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:model="clr-namespace:Sample.Model"
    xmlns:sample="clr-namespace:Sample"
    xmlns:system="clr-namespace:System;assembly=mscorlib"
    xmlns:view="clr-namespace:Sample.View"
    xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
    x:Name="Window"
    Title="AddOrEditAbilityView"
    d:DesignHeight="1000"
    DataContext="{Binding AddOrEditAbilityVM, Source={StaticResource Locator}}"
    Style="{StaticResource FullWindowStyle}"
    mc:Ignorable="d">
    <i:Interaction.Behaviors>
        <behavior:FullWindowBehavior />
        <behavior:PlayEditBehavior />
        <behavior:PlayCloseBehavior />
        <model:MainWindowOwnerBehavior />
    </i:Interaction.Behaviors>
    <Window.Resources>
        <CollectionViewSource x:Key="levelsToCombo" Source="{Binding PersProperty.PersSettings.AbRangs}">
            <CollectionViewSource.SortDescriptions>
                <componentModel:SortDescription Direction="Descending" PropertyName="Ind" />
            </CollectionViewSource.SortDescriptions>
        </CollectionViewSource>
        <model:AbChaRelayVisConverter x:Key="AbChaRelayVisConverter" />
        <model:AbTaskConv x:Key="AbTaskConv" />
        <model:CurAbLevelUnderlineConverter x:Key="AbLevelUnderlineConverter" />
        <model:QwestRelayToAbValueConverter x:Key="QwestRelayToAbValueConverter" />
        <model:AbUslStrikeOutConverter x:Key="AbUslStrikeOutConverter" />
        <model:QwestStrikeOutConverter x:Key="QwestStrikeOutConverter" />
        <model:nullToVisibleConverter x:Key="NullToVisibleConverter" />
        <model:verBacgroundConverter x:Key="VerBacgroundConverter" />
        <model:MultiBoolToVisibleConverter x:Key="MultiBoolToVisibleConverter" />
        <model:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <model:ColorConverter2 x:Key="ColorConverter2" />
        <model:StringToColorConverter x:Key="StringToColorConverter" />
        <model:HeilightItemsControllItemConverter x:Key="HeilightItemsControllItemConverter" />
        <DataTemplate x:Key="AbReqTemplate" DataType="model:AbilReqwirement">
            <TextBlock
                Margin="10,2,2,2"
                Style="{StaticResource TextBlock-SketchWrap}"
                TextAlignment="Left">
                <TextBlock.Text>
                    <MultiBinding Converter="{StaticResource SplitStringsConverter}">
                        <Binding Source="- " />
                        <Binding Path="AbilityProperty.NameOfProperty" />
                    </MultiBinding>
                </TextBlock.Text>
            </TextBlock>
        </DataTemplate>
        <DataTemplate x:Key="ExpanderHeaderTemplate">
            <TextBlock
                Style="{StaticResource TextBlock-SketchWrap}"
                Text="{Binding}"
                TextAlignment="Center" />
        </DataTemplate>
        <Style x:Key="LearForgetStyle" TargetType="ItemsControl">
            <Setter Property="ItemsSource" Value="{Binding DataContext.ModificatorsLearnForget, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="ItemsPanel">
                <Setter.Value>
                    <ItemsPanelTemplate>
                        <UniformGrid Rows="1" />
                    </ItemsPanelTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <model:ItemsCountVisibilityConverter x:Key="ItemsCountVisibilityConverter" />
        <model:GetStringTimeConverter x:Key="GetStringTimeConverter" />
        <model:EmptyStringVisibilityConverter x:Key="EmptyStringVisibilityConverter" />
        <Style x:Key="LevelsCombo" TargetType="ComboBox">
            <Setter Property="VerticalContentAlignment" Value="Stretch" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <!--<Setter Property="ItemsSource" Value="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.PersProperty.PersSettings.AbRangs}" />-->
            <Setter Property="SelectedValuePath" Value="Ind" />
            <Setter Property="Width" Value="80" />
            <Setter Property="ItemTemplate">
                <Setter.Value>
                    <DataTemplate DataType="model:AbRangs">
                        <TextBlock
                            FontSize="14"
                            Text="{Binding Name}"
                            TextAlignment="Center"
                            TextWrapping="Wrap" />
                    </DataTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <Border
        Margin="0"
        VerticalAlignment="Stretch"
        Style="{StaticResource ToolBorder}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Border Style="{StaticResource HeaderBorder}">
                <TextBlock Style="{StaticResource HeaderText}">
                    <TextBlock Text="Настройка навыка ''" />
                    <TextBlock Text="{Binding Text, ElementName=txtName}" />
                    <TextBlock Text="''" />
                </TextBlock>
            </Border>
            <Grid Grid.Row="1" Margin="{StaticResource EditItemGridMargin}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Border DataContext="{Binding DataContext.SelectedAbilitiModelProperty, RelativeSource={RelativeSource AncestorType={x:Type Window}}}">
                    <DockPanel Margin="{StaticResource InfoMarg}">
                        <StackPanel DockPanel.Dock="Top">
                            <!--  Region (Картинка)  -->
                            <DockPanel Margin="{StaticResource PropertyDockPanelMargin}">
                                <TextBlock MinWidth="150" Style="{StaticResource PropertyNameStyle}" />
                                <Button
                                    Background="Transparent"
                                    Command="{Binding DataContext.AddImagePropertyCommand, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"
                                    CommandParameter="добавление"
                                    Style="{StaticResource ButtonWithImageStyle}">
                                    <view:ucImageInTool Picture="{Binding ImageProperty}" />
                                </Button>
                            </DockPanel>

                            <!--  Название  -->
                            <DockPanel Margin="{StaticResource PropertyDockPanelMargin}">
                                <TextBlock Style="{StaticResource PropertyNameStyle}" Text="Название" />
                                <Button
                                    Background="Transparent"
                                    Command="{Binding DataContext.ImgGenFromWord, RelativeSource={RelativeSource AncestorType=Window}}"
                                    Content=" веб изо! "
                                    DockPanel.Dock="Right"
                                    Style="{StaticResource Button-Sketch}"
                                    Visibility="{Binding DataContext.PersProperty.IsSettingsVisibillity, RelativeSource={RelativeSource AncestorType=Window}}" />
                                <xctk:AutoSelectTextBox
                                    x:Name="txtName"
                                    Style="{StaticResource NameElStyle}"
                                    TabIndex="0"
                                    Text="{Binding NameOfProperty, NotifyOnValidationError=True, ValidatesOnExceptions=True}" />
                            </DockPanel>
                            <DockPanel Margin="{StaticResource PropertyDockPanelMargin}" Visibility="{Binding DataContext.IsDevMode, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}}">
                                <TextBlock Style="{StaticResource PropertyNameStyle}" Text="Тип" />
                                <xctk:AutoSelectTextBox
                                    MinWidth="150"
                                    Style="{StaticResource PropertyAutoSellectTextBoxStyle}"
                                    TabIndex="0"
                                    Text="{Binding Type, NotifyOnValidationError=True, ValidatesOnExceptions=True}"
                                    TextAlignment="Center"
                                    ToolTip="1-тело, 2-ум, 3-дух, 4-прочее..." />
                                <Button
                                    Margin="2,0"
                                    Background="Transparent"
                                    Command="{Binding DataContext.ExportItCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                    Content="Экспорт"
                                    Style="{StaticResource Button-Sketch}" />
                            </DockPanel>

                            <!--  Значение  -->
                            <DockPanel Margin="{StaticResource PropertyDockPanelMargin}">
                                <TextBlock Style="{StaticResource PropertyNameStyle}" Text="Прогресс" />
                                <view:ucProgressBarWithScale
                                    IsShowScale="Visible"
                                    Maximum="{Binding Path=(model:StaticMetods.MaxAbLevel), Mode=OneWay}"
                                    Minimum="0"
                                    Text="{Binding RangName, Mode=OneWay}"
                                    Value="{Binding ValueToProgress, Mode=OneWay}" />
                            </DockPanel>

                            <!--  Region (Начальное значение)  -->
                            <!--<DockPanel Margin="{StaticResource PropertyDockPanelMargin}" Visibility="{Binding DataContext.IsSetViz, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}}">
                                <TextBlock Style="{StaticResource PropertyNameStyle}" Text="Начальное значение" />
                                <DockPanel>
                                    <TextBlock
                                        MinWidth="30"
                                        Margin="0,0,3,0"
                                        Style="{StaticResource TextBlock-SketchWrap}"
                                        Text="{Binding AbFirstRang}"
                                        TextAlignment="Center" />
                                    <Grid>
                                        <Slider
                                            VerticalAlignment="Center"
                                            IsSnapToTickEnabled="True"
                                            Maximum="{Binding Path=(model:StaticMetods.MaxAbLevel), Mode=OneWay}"
                                            Minimum="0"
                                            TickFrequency="1"
                                            TickPlacement="Both"
                                            Value="{Binding FirstVal}" />
                                    </Grid>
                                </DockPanel>
                            </DockPanel>-->

                            <!--  Влияение на характеристики  -->
                            <DockPanel Margin="{StaticResource PropertyDockPanelMargin}" Visibility="{Binding DataContext.IsSetViz, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=инверсия}">
                                <TextBlock Style="{StaticResource PropertyNameStyle}" Text="Влияние" />
                                <TextBlock
                                    Style="{StaticResource TextBlock-SketchWrap}"
                                    Text="{Binding DataContext.ChaRelsString, RelativeSource={RelativeSource AncestorType=Window}}"
                                    TextAlignment="Left" />
                            </DockPanel>
                            <DockPanel Margin="{StaticResource PropertyDockPanelMargin}" Visibility="{Binding DataContext.IsSetViz, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}}">
                                <TextBlock Style="{StaticResource PropertyNameStyle}" Text="Влияние" />
                                <ItemsControl ItemsSource="{Binding DataContext.RelaysToChas, RelativeSource={RelativeSource AncestorType=Window}}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border
                                                Margin="2"
                                                BorderBrush="{StaticResource BorderBrush}"
                                                BorderThickness="1">
                                                <StackPanel
                                                    Margin="4"
                                                    HorizontalAlignment="Left"
                                                    Orientation="Horizontal">
                                                    <ComboBox
                                                        MinWidth="70"
                                                        Margin="0,0,5,0"
                                                        VerticalAlignment="Center"
                                                        HorizontalContentAlignment="Center"
                                                        DisplayMemberPath="NameProperty"
                                                        ItemsSource="{Binding NeedAbility.Koefs}"
                                                        SelectedValue="{Binding NeedAbility.KoeficientProperty}"
                                                        SelectedValuePath="KProperty"
                                                        Style="{StaticResource ComboBoxStyle}"
                                                        ToolTip="Влияние" />
                                                    <TextBlock Style="{StaticResource TextBlock-SketchWrap}" Text="{Binding Charact.NameOfProperty}" />
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </DockPanel>

                            <!--<DockPanel Margin="{StaticResource PropertyDockPanelMargin}">
                                <TextBlock Style="{StaticResource PropertyNameStyle}" Text="Характеристика" />
                                <UniformGrid Rows="1">
                                    <TextBlock
                                        Style="{StaticResource TextBlock-SketchWrap}"
                                        Text="{Binding RuleCharacterisic.NameOfProperty}"
                                        Visibility="{Binding DataContext.IsSetViz, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=инверсия}" />

                                    <ComboBox
                                        DisplayMemberPath="NameOfProperty"
                                        ItemsSource="{Binding DataContext.PersProperty.Characteristics, RelativeSource={RelativeSource AncestorType=Window}}"
                                        SelectedValue="{Binding RuleCharacterisic}"
                                        Style="{StaticResource ComboBoxStyle}"
                                        Visibility="{Binding DataContext.IsSetViz, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}}" />
                                </UniformGrid>
                            </DockPanel>-->

                            <!--  Прокачка  -->
                            <DockPanel Margin="{StaticResource PropertyDockPanelMargin}" Visibility="{Binding IsBuyVisibility}">
                                <TextBlock Style="{StaticResource PropertyNameStyle}" Text="Прокачка" />
                                <DockPanel>
                                    <Button
                                        Command="{Binding DataContext.BuyAbCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                        Style="{StaticResource ButtonUp}"
                                        ToolTip="{Binding AbBuyToolTip}" />
                                </DockPanel>
                            </DockPanel>

                            <!--  Требования  -->
                            <DockPanel Margin="{StaticResource PropertyDockPanelMargin}" Visibility="{Binding ClearedNotAllowReqwirements, Converter={StaticResource NullToVisibleConverter}, ConverterParameter=string}">
                                <TextBlock Style="{StaticResource PropertyNameStyle}" Text="Требования" />
                                <TextBlock
                                    Foreground="Red"
                                    Style="{StaticResource TextBlock-SketchWrap}"
                                    Text="{Binding ClearedNotAllowReqwirements}"
                                    Visibility="{Binding ClearedNotAllowReqwirements, Converter={StaticResource NullToVisibleConverter}, ConverterParameter=string}" />
                            </DockPanel>

                            <!--  Награды?  -->
                            <DockPanel Margin="{StaticResource PropertyDockPanelMargin}" Visibility="{Binding UcElementRewardsViewModel.IsVisible}">
                                <TextBlock Style="{StaticResource PropertyNameStyle}" Text="Награды" />
                                <view:ucElementRewardsView DataContext="{Binding UcElementRewardsViewModel}" />
                            </DockPanel>

                            <!--<DockPanel Margin="{StaticResource PropertyDockPanelMargin}" Visibility="{Binding DataContext.IsSetViz, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}}">
                                <TextBlock Style="{StaticResource PropertyNameStyle}" Text="" />
                                <Expander Header="Продвинутые настройки">
                                    <Expander.HeaderTemplate>
                                        <DataTemplate>
                                            <TextBlock Style="{StaticResource TextBlock-SketchWrap}" Text="{Binding}" />
                                        </DataTemplate>
                                    </Expander.HeaderTemplate>
                                    <StackPanel>
                            -->
                            <!--  Монстры сразу?  -->
                            <!--
                                        <GroupBox Header="Монстры стразу?" Style="{StaticResource GroupBoxStyle}">
                                            <CheckBox
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                IsChecked="{Binding IsMonstersall}" />
                                        </GroupBox>

                            -->
                            <!--  Бустер  -->
                            <!--
                                        <GroupBox Header="Бустер" Style="{StaticResource GroupBoxStyle}">
                                            <xctk:AutoSelectTextBox
                                                Style="{StaticResource PropertyAutoSellectTextBoxStyle}"
                                                Text="{Binding Booster, UpdateSourceTrigger=PropertyChanged}"
                                                TextAlignment="Center"
                                                ToolTip="Чем больше число, тем быстрее прокачивается навык от задач" />
                                        </GroupBox>

                            -->
                            <!--  Раз сделать  -->
                            <!--
                                        <GroupBox Header="Выполнить все задачи до полной прокачки, раз" Style="{StaticResource GroupBoxStyle}">
                                            <xctk:AutoSelectTextBox
                                                Style="{StaticResource PropertyAutoSellectTextBoxStyle}"
                                                Text="{Binding NforAllDone}"
                                                TextAlignment="Center"
                                                ToolTip="Если не 0, то столько раз надо выполнить задачу до полной прокачки навыка" />
                                        </GroupBox>
                                    </StackPanel>
                                </Expander>
                            </DockPanel>-->



                            <!--<DockPanel Margin="{StaticResource PropertyDockPanelMargin}" Visibility="{Binding NotAllowReqwirements, Converter={StaticResource EmptyStringVisibilityConverter}}">
                                <TextBlock Style="{StaticResource PropertyNameStyle}" Text="Требования" />
                                <DockPanel>
                                    <TextBlock
                                        DockPanel.Dock="Bottom"
                                        Foreground="Red"
                                        Style="{StaticResource TextBlock-SketchWrap}"
                                        Text="{Binding NotAllowReqwirements}"
                                        TextAlignment="Center" />
                                </DockPanel>
                            </DockPanel>-->

                            <!--  Влияние на характеристики  -->
                            <!--<DockPanel Margin="{StaticResource PropertyDockPanelMargin}">
                                <TextBlock Style="{StaticResource PropertyNameStyle}" Text="Влияние на характеристики" />

                                <ItemsControl
                                    VerticalAlignment="Top"
                                    HorizontalContentAlignment="Stretch"
                                    VerticalContentAlignment="Stretch"
                                    ItemsSource="{Binding DataContext.ChangeCharacts, RelativeSource={RelativeSource AncestorType=Window}}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border BorderBrush="Transparent" Style="{StaticResource RelaysBorderStyle}">
                                                <Grid Background="White">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="2*" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock
                                                            Style="{StaticResource TextBlock-Sketch}"
                                                            TextAlignment="Center"
                                                            TextWrapping="Wrap">
                                                            <Hyperlink Command="{Binding DataContext.OpenRelayCharacteristicCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding Item1}">
                                                                <Run FontWeight="Bold" Text="{Binding Item1.NameOfProperty}" />
                                                            </Hyperlink>
                                                        </TextBlock>

                                                        <ListBox
                                                            Grid.Column="1"
                                                            BorderBrush="Transparent"
                                                            ItemsSource="{Binding DataContext.KMissionsRelays, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            SelectedValue="{Binding Item2.KoeficientProperty, Mode=TwoWay}"
                                                            SelectedValuePath="KProperty"
                                                            Style="{StaticResource HorizontalButtonsListBoxStyle}">
                                                            <ListBox.ItemContainerStyle>
                                                                <Style BasedOn="{StaticResource HorBContaynerStyle}" TargetType="{x:Type ListBoxItem}">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Value="false">
                                                                            <DataTrigger.Binding>
                                                                                <MultiBinding Converter="{StaticResource AbChaRelayVisConverter}">
                                                                                    <Binding Path="." />
                                                                                    <Binding Path="DataContext.Item1" RelativeSource="{RelativeSource AncestorType=Grid}" />
                                                                                    <Binding Path="DataContext.SelectedAbilitiModelProperty" RelativeSource="{RelativeSource AncestorType=Window}" />
                                                                                </MultiBinding>
                                                                            </DataTrigger.Binding>
                                                                            <Setter Property="Visibility" Value="Hidden" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </ListBox.ItemContainerStyle>
                                                            <ListBox.ItemTemplate>
                                                                <DataTemplate>
                                                                    <TextBlock
                                                                        Margin="0,2"
                                                                        Style="{StaticResource TextBlock-SketchWrap}"
                                                                        Text="{Binding NameProperty}"
                                                                        TextAlignment="Center" />
                                                                </DataTemplate>
                                                            </ListBox.ItemTemplate>
                                                        </ListBox>
                                                    </Grid>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </DockPanel>-->
                        </StackPanel>
                        <!--  Описание  -->
                        <DockPanel Grid.Row="1" Margin="{StaticResource PropertyDockPanelMargin}">
                            <TextBlock
                                VerticalAlignment="Top"
                                Style="{StaticResource PropertyNameStyle}"
                                Text="Описание" />
                            <xctk:AutoSelectTextBox
                                Style="{StaticResource AboutTextBoxStyle}"
                                TabIndex="1"
                                Text="{Binding DescriptionProperty}" />
                        </DockPanel>
                    </DockPanel>
                </Border>

                <TabControl Grid.Column="1" Margin="5">
                    <TabItem DataContext="{Binding DataContext.SelectedAbilitiModelProperty, RelativeSource={RelativeSource AncestorType=Window}}" Header="Монстры">
                        <TabItem.HeaderTemplate>
                            <DataTemplate>
                                <TextBlock Style="{StaticResource TextBlock-SketchWrap}">
                                    <Run Text="Условия" />
                                </TextBlock>
                            </DataTemplate>
                        </TabItem.HeaderTemplate>
                        <ScrollViewer Margin="{StaticResource ElementScrollMarg}" Style="{StaticResource EditableItemScroll}">
                            <i:Interaction.Behaviors>
                                <behavior:VerticalScrollBehavior />
                            </i:Interaction.Behaviors>
                            <StackPanel>
                                <!--<GroupBox
                                    DockPanel.Dock="Top"
                                    Header="Монстры"
                                    Style="{StaticResource myGroupBoxStyle}">
                                </GroupBox>-->
                                <StackPanel>
                                    <TextBlock
                                        FontSize="20"
                                        FontWeight="Bold"
                                        Style="{StaticResource TextBlock-SketchWrap}"
                                        Text="{Binding SelH}"
                                        TextAlignment="Center"
                                        Visibility="Collapsed" />
                                    <ItemsControl Margin="2,2,2,0" ItemsSource="{Binding ComplecsComplecsNeed}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Grid>
                                                    <Border Margin="0">
                                                        <DockPanel x:Name="xBord">
                                                            <DockPanel.Resources>
                                                                <CollectionViewSource x:Key="reqs" Source="{Binding Value}">
                                                                    <CollectionViewSource.SortDescriptions>
                                                                        <componentModel:SortDescription Direction="Descending" PropertyName="NeedTask" />
                                                                    </CollectionViewSource.SortDescriptions>
                                                                </CollectionViewSource>
                                                            </DockPanel.Resources>
                                                            <Border
                                                                Width="50"
                                                                Margin="0"
                                                                BorderBrush="DarkSlateGray"
                                                                BorderThickness="0"
                                                                DockPanel.Dock="Right">
                                                                <Border.Background>
                                                                    <LinearGradientBrush SpreadMethod="Reflect" StartPoint="0,0" EndPoint="0, 0.5">
                                                                        <GradientStop Color="{Binding Key.BacBrush}" />
                                                                        <GradientStop Offset="1" Color="{Binding Key.BacBrush}" />
                                                                    </LinearGradientBrush>
                                                                </Border.Background>
                                                                <StackPanel Margin="2" VerticalAlignment="Top">
                                                                    <UniformGrid
                                                                        HorizontalAlignment="Center"
                                                                        Rows="1"
                                                                        Visibility="{Binding DataContext.IsSetViz, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}}">
                                                                        <Button
                                                                            Background="Transparent"
                                                                            Command="{Binding DataContext.AddTaskNeedCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                            CommandParameter="{Binding Key.index}"
                                                                            DockPanel.Dock="Right"
                                                                            Style="{StaticResource ButtonAdd}">
                                                                            <!--  Visibility="{Binding Key.IsLastLev, Converter={StaticResource BoolToVisibilityConverter}}"  -->
                                                                            <Button.ToolTip>
                                                                                <StackPanel>
                                                                                    <TextBlock Text="Создать монстра" />
                                                                                    <TextBlock Text="------------------------------------------" />
                                                                                    <TextBlock Text="+cntrl авто по очереди" />
                                                                                    <TextBlock Text="+alt авто постепенно" />
                                                                                    <TextBlock Text="+shift авто сразу" />
                                                                                    <!--<TextBlock Text="+cntrl автозаполнение (сначала надо заполнить последний уровень)" />-->
                                                                                </StackPanel>
                                                                            </Button.ToolTip>
                                                                        </Button>
                                                                    </UniformGrid>

                                                                    <Border
                                                                        Margin="2,4"
                                                                        VerticalAlignment="Center"
                                                                        Visibility="{Binding Key.HardnessDescr, Converter={StaticResource EmptyStringVisibilityConverter}}">
                                                                        <TextBlock
                                                                            Margin="2"
                                                                            FontWeight="Bold"
                                                                            Style="{StaticResource TextBlock-SketchWrap}"
                                                                            TextAlignment="Center">
                                                                            <TextBlock.Text>
                                                                                <MultiBinding Converter="{StaticResource SplitStringsConverter}">
                                                                                    <Binding Source="" />
                                                                                    <Binding Path="Key.HardnessDescr" />
                                                                                    <Binding Source="" />
                                                                                </MultiBinding>
                                                                            </TextBlock.Text>
                                                                            <!--  TextDecorations="{Binding Key.IsCurLev, Converter={StaticResource AbLevelUnderlineConverter}}"  -->
                                                                            <!--<TextBlock.TextDecorations>
                                                                                <MultiBinding Converter="{StaticResource AbUslStrikeOutConverter}" ConverterParameter="index">
                                                                                    <Binding
                                                                                        Mode="OneWay"
                                                                                        Path="DataContext.SelectedAbilitiModelProperty"
                                                                                        RelativeSource="{RelativeSource AncestorType=Window}" />
                                                                                    <Binding Path="Key.index" />
                                                                                </MultiBinding>
                                                                            </TextBlock.TextDecorations>-->
                                                                        </TextBlock>
                                                                        <Border.Background>
                                                                            <SolidColorBrush Opacity="0.75" Color="White" />
                                                                        </Border.Background>
                                                                    </Border>
                                                                </StackPanel>
                                                            </Border>
                                                            <ListBox
                                                                Margin="14,3,3,3"
                                                                VerticalAlignment="Center"
                                                                ItemsSource="{Binding Source={StaticResource reqs}}"
                                                                SelectedValue="{Binding DataContext.SelAbNeed, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                Style="{StaticResource ListsStyle}">
                                                                <!--    -->
                                                                <ListBox.Opacity>
                                                                    <MultiBinding Converter="{StaticResource AbUslStrikeOutConverter}" ConverterParameter="Opacity2">
                                                                        <Binding Mode="OneWay" Path="Key.index" />
                                                                        <Binding
                                                                            Mode="OneWay"
                                                                            Path="DataContext.SelectedAbilitiModelProperty"
                                                                            RelativeSource="{RelativeSource AncestorType=Window}" />
                                                                    </MultiBinding>
                                                                </ListBox.Opacity>
                                                                <ListBox.ItemTemplate>
                                                                    <DataTemplate DataType="ViewModel:ComplecsNeed">
                                                                        <DockPanel MinHeight="10" Background="White">
                                                                            <!--<DockPanel.Opacity>
                                                                        <MultiBinding Converter="{StaticResource AbUslStrikeOutConverter}" ConverterParameter="Opacity">
                                                                            <Binding Mode="OneWay" Path="NeedTask" />
                                                                            <Binding
                                                                                Mode="OneWay"
                                                                                Path="DataContext.SelectedAbilitiModelProperty"
                                                                                RelativeSource="{RelativeSource AncestorType=Window}" />
                                                                        </MultiBinding>
                                                                    </DockPanel.Opacity>-->
                                                                            <!--<Border
                                                                                Width="75"
                                                                                DockPanel.Dock="Right"
                                                                                Visibility="{Binding IsQwest, Converter={StaticResource BoolToVisibilityConverter}}">
                                                                                <DockPanel>
                                                                                    <TextBlock
                                                                                        Foreground="Green"
                                                                                        Style="{StaticResource TextBlock-SketchWrap}"
                                                                                        Text="+" />
                                                                                    <xctk:AutoSelectTextBox
                                                                                        MinWidth="0"
                                                                                        VerticalAlignment="Center"
                                                                                        Foreground="Green"
                                                                                        Style="{StaticResource AutoSelectTextBoxStyle}"
                                                                                        Text="{Binding KRelay}"
                                                                                        TextAlignment="Center"
                                                                                        ToolTip="Влияние на навык. 1 очко - один уровень, можно писать нецелые числа!!" />
                                                                                </DockPanel>
                                                                            </Border>-->
                                                                            <DockPanel>
                                                                                <Grid Background="White" DockPanel.Dock="Top">
                                                                                    <Grid.ColumnDefinitions>
                                                                                        <ColumnDefinition Width="*" />
                                                                                        <ColumnDefinition Width="Auto" />
                                                                                    </Grid.ColumnDefinitions>
                                                                                    <Grid.InputBindings>
                                                                                        <MouseBinding
                                                                                            Command="{Binding DataContext.EditObjectCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                                            CommandParameter="{Binding}"
                                                                                            Gesture="LeftDoubleClick" />
                                                                                    </Grid.InputBindings>
                                                                                    <StackPanel
                                                                                        Grid.Column="0"
                                                                                        Margin="2"
                                                                                        VerticalAlignment="Center">
                                                                                        <DockPanel>
                                                                                            <Grid Margin="0,0,10,0" DockPanel.Dock="Left">
                                                                                                <Grid.Resources>
                                                                                                    <CollectionViewSource x:Key="levelsToComboCollectionView1" Source="{Binding DataContext.PersProperty.PersSettings.AbRangs, RelativeSource={RelativeSource AncestorType=Window}}">
                                                                                                        <CollectionViewSource.SortDescriptions>
                                                                                                            <componentModel:SortDescription Direction="Ascending" PropertyName="Ind" />
                                                                                                        </CollectionViewSource.SortDescriptions>
                                                                                                    </CollectionViewSource>
                                                                                                </Grid.Resources>
                                                                                                <ComboBox
                                                                                                    ItemsSource="{Binding Source={StaticResource levelsToComboCollectionView1}}"
                                                                                                    SelectedValue="{Binding LevelProperty}"
                                                                                                    Style="{StaticResource LevelsCombo}"
                                                                                                    ToolTip="С какого уровня навыка требование активно"
                                                                                                    Visibility="{Binding DataContext.IsSetViz, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}}" />
                                                                                            </Grid>
                                                                                            <Grid Margin="10,0,0,0" DockPanel.Dock="Right">
                                                                                                <Grid.Resources>
                                                                                                    <CollectionViewSource x:Key="levelsToComboCollectionView2" Source="{Binding DataContext.PersProperty.PersSettings.AbRangs, RelativeSource={RelativeSource AncestorType=Window}}">
                                                                                                        <CollectionViewSource.SortDescriptions>
                                                                                                            <componentModel:SortDescription Direction="Ascending" PropertyName="Ind" />
                                                                                                        </CollectionViewSource.SortDescriptions>
                                                                                                    </CollectionViewSource>
                                                                                                </Grid.Resources>
                                                                                                <ComboBox
                                                                                                    Margin="10,0,0,0"
                                                                                                    DockPanel.Dock="Right"
                                                                                                    ItemsSource="{Binding Source={StaticResource levelsToComboCollectionView2}}"
                                                                                                    SelectedValue="{Binding ToLevelProperty}"
                                                                                                    Style="{StaticResource LevelsCombo}"
                                                                                                    ToolTip="До какого уровня навыка требование активно"
                                                                                                    Visibility="{Binding DataContext.IsSetViz, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}}" />
                                                                                            </Grid>
                                                                                            <StackPanel>
                                                                                                <DockPanel>

                                                                                                    <!--  Название  -->
                                                                                                    <TextBlock
                                                                                                        Style="{StaticResource TextBlock-Sketch}"
                                                                                                        TextAlignment="Center"
                                                                                                        TextWrapping="Wrap">
                                                                                                        <TextBlock.Text>
                                                                                                            <MultiBinding Converter="{StaticResource SplitStringsConverter}">
                                                                                                                <Binding Path="NeedTask.TaskProperty.NameOfProperty" />
                                                                                                                <Binding Path="NeedTask.TaskProperty.PlusNameOf3" />
                                                                                                            </MultiBinding>
                                                                                                        </TextBlock.Text>
                                                                                                        <!--<TextBlock.TextDecorations>
                                                                                                            <MultiBinding Converter="{StaticResource AbUslStrikeOutConverter}">
                                                                                                                <Binding Mode="OneWay" Path="NeedTask" />
                                                                                                                <Binding
                                                                                                                    Mode="OneWay"
                                                                                                                    Path="DataContext.SelectedAbilitiModelProperty"
                                                                                                                    RelativeSource="{RelativeSource AncestorType=Window}" />
                                                                                                                <Binding Path="DataContext.Key.index" RelativeSource="{RelativeSource AncestorType=ListBox}" />
                                                                                                            </MultiBinding>
                                                                                                        </TextBlock.TextDecorations>-->
                                                                                                    </TextBlock>
                                                                                                    <!--  Таймер, Счетчик  -->
                                                                                                </DockPanel>
                                                                                                <StackPanel
                                                                                                    Margin="2"
                                                                                                    HorizontalAlignment="Center"
                                                                                                    Orientation="Horizontal">
                                                                                                    <TextBlock
                                                                                                        DockPanel.Dock="Right"
                                                                                                        FontSize="14"
                                                                                                        FontStyle="Italic"
                                                                                                        Foreground="Green"
                                                                                                        Style="{StaticResource TextBlock-SketchWrap}"
                                                                                                        Text="{Binding NeedTask.TaskProperty.DescriptionForAbility}"
                                                                                                        TextAlignment="Left"
                                                                                                        Visibility="{Binding Path=DataContext.Key.IsLastLev, RelativeSource={RelativeSource AncestorType=ListBox}, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=инверсия}">
                                                                                                        <!--<TextBlock.Text>
                                                                                                            <MultiBinding Converter="{StaticResource AbTaskConv}" Mode="OneWay">
                                                                                                                <Binding Path="DataContext.Key.IsCurLev" RelativeSource="{RelativeSource AncestorType=ListBox}" />
                                                                                                                <Binding Path="NeedTask.TaskProperty.BeginDateProperty" />
                                                                                                                <Binding Path="NeedTask.TaskProperty.TimeString" />
                                                                                                                <Binding Path="NeedTask.TaskProperty.RecurrenceString" />
                                                                                                            </MultiBinding>
                                                                                                        </TextBlock.Text>-->
                                                                                                        <!--<TextBlock.TextDecorations>
                                                                                                            <MultiBinding Converter="{StaticResource AbUslStrikeOutConverter}">
                                                                                                                <Binding Mode="OneWay" Path="NeedTask" />
                                                                                                                <Binding
                                                                                                                    Mode="OneWay"
                                                                                                                    Path="DataContext.SelectedAbilitiModelProperty"
                                                                                                                    RelativeSource="{RelativeSource AncestorType=Window}" />
                                                                                                                <Binding Path="DataContext.Key.index" RelativeSource="{RelativeSource AncestorType=ListBox}" />
                                                                                                            </MultiBinding>
                                                                                                        </TextBlock.TextDecorations>-->
                                                                                                    </TextBlock>
                                                                                                    <TextBlock
                                                                                                        DockPanel.Dock="Right"
                                                                                                        FontSize="14"
                                                                                                        FontStyle="Italic"
                                                                                                        Foreground="Green"
                                                                                                        Style="{StaticResource TextBlock-SketchWrap}"
                                                                                                        Text="{Binding NeedTask.TaskProperty.DescriptionForAbilityLast}"
                                                                                                        TextAlignment="Left"
                                                                                                        Visibility="{Binding Path=DataContext.Key.IsLastLev, RelativeSource={RelativeSource AncestorType=ListBox}, Converter={StaticResource BoolToVisibilityConverter}}" />

                                                                                                    <!--<DockPanel Margin="10,0,0,0" Visibility="{Binding NeedTask.TaskProperty.MesureVisibility}">
                                                                                                        <ContentControl Height="{StaticResource iconHeight}" Template="{StaticResource ContentControlDoneIcon}" />
                                                                                                        <TextBlock
                                                                                                            Margin="0,0,0,0"
                                                                                                            FontWeight="Bold"
                                                                                                            Style="{StaticResource TextBlock-SketchWrap}"
                                                                                                            TextAlignment="Center"
                                                                                                            Visibility="{Binding Path=DataContext.Key.IsLastLev, RelativeSource={RelativeSource AncestorType=ListBox}, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=инверсия}">
                                                                                                            <TextBlock.Inlines>
                                                                                                                <Run Text="{Binding NeedTask.TaskProperty.Mesure}" />
                                                                                                            </TextBlock.Inlines>
                                                                                                        </TextBlock>
                                                                                                        <TextBlock
                                                                                                            Margin="0,0,0,0"
                                                                                                            FontWeight="Bold"
                                                                                                            Style="{StaticResource TextBlock-SketchWrap}"
                                                                                                            TextAlignment="Center"
                                                                                                            Visibility="{Binding Path=DataContext.Key.IsLastLev, RelativeSource={RelativeSource AncestorType=ListBox}, Converter={StaticResource BoolToVisibilityConverter}}">
                                                                                                            <TextBlock.Inlines>
                                                                                                                <Run Text="{Binding NeedTask.TaskProperty.LastMesure, Mode=OneWay}" />
                                                                                                            </TextBlock.Inlines>
                                                                                                        </TextBlock>
                                                                                                    </DockPanel>
                                                                                                    <DockPanel Margin="10,0,0,0" Visibility="{Binding NeedTask.TaskProperty.TimerVisibility}">
                                                                                                        <ContentControl Height="{StaticResource iconHeight}" Style="{StaticResource SandWatchStyle}" />
                                                                                                        <TextBlock
                                                                                                            Margin="5,0,0,0"
                                                                                                            FontWeight="Bold"
                                                                                                            Style="{StaticResource TextBlock-SketchWrap}"
                                                                                                            TextAlignment="Center"
                                                                                                            Visibility="{Binding Path=DataContext.Key.IsLastLev, RelativeSource={RelativeSource AncestorType=ListBox}, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=инверсия}">
                                                                                                            <TextBlock.Inlines>
                                                                                                                <Run Text="{Binding NeedTask.TaskProperty.TimeMustProperty}" />
                                                                                                            </TextBlock.Inlines>
                                                                                                        </TextBlock>
                                                                                                        <TextBlock
                                                                                                            Margin="5,0,0,0"
                                                                                                            FontWeight="Bold"
                                                                                                            Style="{StaticResource TextBlock-SketchWrap}"
                                                                                                            TextAlignment="Center"
                                                                                                            Visibility="{Binding Path=DataContext.Key.IsLastLev, RelativeSource={RelativeSource AncestorType=ListBox}, Converter={StaticResource BoolToVisibilityConverter}}">
                                                                                                            <TextBlock.Inlines>
                                                                                                                <Run Text="{Binding NeedTask.TaskProperty.LastTimer, Mode=OneWay}" />
                                                                                                            </TextBlock.Inlines>
                                                                                                        </TextBlock>
                                                                                                    </DockPanel>
                                                                                                    <DockPanel Margin="10,0,0,0" Visibility="{Binding NeedTask.TaskProperty.PomodorroVisibillity}">
                                                                                                        <ContentControl Height="{StaticResource iconHeight}" Template="{StaticResource ContentControlPomodoro}" />
                                                                                                        <TextBlock
                                                                                                            Margin="5,0,0,0"
                                                                                                            FontWeight="Bold"
                                                                                                            Style="{StaticResource TextBlock-SketchWrap}"
                                                                                                            TextAlignment="Center">
                                                                                                            <TextBlock.Inlines>
                                                                                                                <Run Text="{Binding NeedTask.TaskProperty.PomodorroMax}" />
                                                                                                            </TextBlock.Inlines>
                                                                                                        </TextBlock>
                                                                                                    </DockPanel>-->
                                                                                                </StackPanel>
                                                                                                <TextBlock
                                                                                                    DockPanel.Dock="Top"
                                                                                                    FontSize="12"
                                                                                                    FontStyle="Italic"
                                                                                                    Style="{StaticResource TextBlock-SketchWrap}"
                                                                                                    Text="{Binding NeedTask.TaskProperty.SubTasksStringAb}"
                                                                                                    TextAlignment="Center"
                                                                                                    Visibility="{Binding NeedTask.TaskProperty.SubTasksStringAb, Converter={StaticResource EmptyStringVisibilityConverter}}">
                                                                                                    <TextBlock.TextDecorations>
                                                                                                        <MultiBinding Converter="{StaticResource AbUslStrikeOutConverter}">
                                                                                                            <Binding Mode="OneWay" Path="NeedTask" />
                                                                                                            <Binding
                                                                                                                Mode="OneWay"
                                                                                                                Path="DataContext.SelectedAbilitiModelProperty"
                                                                                                                RelativeSource="{RelativeSource AncestorType=Window}" />
                                                                                                            <Binding Path="DataContext.Key.index" RelativeSource="{RelativeSource AncestorType=ListBox}" />
                                                                                                        </MultiBinding>
                                                                                                    </TextBlock.TextDecorations>
                                                                                                </TextBlock>
                                                                                            </StackPanel>
                                                                                        </DockPanel>
                                                                                    </StackPanel>
                                                                                    <UniformGrid
                                                                                        x:Name="mainMenu"
                                                                                        Grid.Column="1"
                                                                                        Rows="1"
                                                                                        Visibility="Collapsed">
                                                                                        <!--<Button
                                                                                    Background="Transparent"
                                                                                    Command="{Binding DataContext.CopyTaskUslDownCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                                    CommandParameter="{Binding LevelProperty}"
                                                                                    DockPanel.Dock="Right"
                                                                                    Style="{StaticResource ButtonDown}"
                                                                                    Visibility="Collapsed">
                                                                                    <Button.ToolTip>
                                                                                        <StackPanel>
                                                                                            <TextBlock Text="Скопировать задачу в условия вниз (+alt с редактированием)" />
                                                                                        </StackPanel>
                                                                                    </Button.ToolTip>
                                                                                </Button>-->
                                                                                        <!--<Button
                                                                                            Grid.Column="2"
                                                                                            Background="Transparent"
                                                                                            BorderBrush="Transparent"
                                                                                            Command="{Binding DataContext.EditObjectCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                                            CommandParameter="{Binding}"
                                                                                            DockPanel.Dock="Right"
                                                                                            Style="{StaticResource ButtonSettings}"
                                                                                            ToolTip="Просмотр" />-->
                                                                                        <Button
                                                                                            Background="Transparent"
                                                                                            BorderBrush="Transparent"
                                                                                            Command="{Binding DataContext.DelObjectCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                                            CommandParameter="{Binding}"
                                                                                            DockPanel.Dock="Right"
                                                                                            Style="{StaticResource ButtonDelete}"
                                                                                            ToolTip="Удаление"
                                                                                            Visibility="{Binding DataContext.IsSetViz, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}}" />
                                                                                    </UniformGrid>
                                                                                </Grid>
                                                                            </DockPanel>
                                                                        </DockPanel>
                                                                        <DataTemplate.Triggers>
                                                                            <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ListBoxItem}}, Path=IsSelected}" Value="True">
                                                                                <Setter TargetName="mainMenu" Property="Visibility" Value="Visible" />
                                                                            </DataTrigger>
                                                                        </DataTemplate.Triggers>
                                                                    </DataTemplate>
                                                                </ListBox.ItemTemplate>
                                                            </ListBox>
                                                        </DockPanel>
                                                    </Border>
                                                    <Border BorderBrush="SlateGray" BorderThickness="1">
                                                        <!--<Border.Opacity>
                                                            <MultiBinding Converter="{StaticResource AbUslStrikeOutConverter}" ConverterParameter="Opacity2">
                                                                <Binding Mode="OneWay" Path="Key.index" />
                                                                <Binding
                                                                    Mode="OneWay"
                                                                    Path="DataContext.SelectedAbilitiModelProperty"
                                                                    RelativeSource="{RelativeSource AncestorType=Window}" />
                                                            </MultiBinding>
                                                        </Border.Opacity>
                                                        <Border.BorderThickness>

                                                            <MultiBinding Converter="{StaticResource AbUslStrikeOutConverter}" ConverterParameter="Thikness">
                                                                <Binding Mode="OneWay" Path="Key.index" />
                                                                <Binding
                                                                    Mode="OneWay"
                                                                    Path="DataContext.SelectedAbilitiModelProperty"
                                                                    RelativeSource="{RelativeSource AncestorType=Window}" />
                                                            </MultiBinding>
                                                        </Border.BorderThickness>-->
                                                    </Border>
                                                </Grid>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>

                                <!--  EXTENDEDVERS  -->
                                <Grid Margin="0,12,0,0" DockPanel.Dock="Top">
                                    <GroupBox Style="{StaticResource myGroupBoxStyle}">
                                        <GroupBox.HeaderTemplate>
                                            <DataTemplate>
                                                <DockPanel Margin="{StaticResource MyGroupTemplMarg}">
                                                    <UniformGrid
                                                        DockPanel.Dock="Right"
                                                        Rows="1"
                                                        Visibility="{Binding DataContext.IsSetViz, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}}">
                                                        <Button
                                                            HorizontalAlignment="Right"
                                                            Background="Transparent"
                                                            Command="{Binding DataContext.AddQwToUpAbCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            DockPanel.Dock="Top"
                                                            Style="{StaticResource ButtonAdd}"
                                                            Visibility="{Binding IsPayedProperty, Converter={StaticResource BoolToVisibilityConverter}}">
                                                            <Button.ToolTip>
                                                                <StackPanel>
                                                                    <TextBlock Text="Создать квест, прокачивающий навык" />
                                                                </StackPanel>
                                                            </Button.ToolTip>
                                                        </Button>
                                                        <Button
                                                            HorizontalAlignment="Right"
                                                            Background="Transparent"
                                                            DockPanel.Dock="Top"
                                                            Style="{StaticResource ButtonImport}"
                                                            Visibility="{Binding IsPayedProperty, Converter={StaticResource BoolToVisibilityConverter}}">
                                                            <Button.ToolTip>
                                                                <StackPanel>
                                                                    <TextBlock Text="Выбрать квест, который будет прокачивать навык" />
                                                                </StackPanel>
                                                            </Button.ToolTip>
                                                            <i:Interaction.Triggers>
                                                                <i:EventTrigger EventName="Click">
                                                                    <ei:ChangePropertyAction
                                                                        PropertyName="IsOpen"
                                                                        TargetName="pAddAbUps"
                                                                        Value="True" />
                                                                </i:EventTrigger>
                                                            </i:Interaction.Triggers>
                                                        </Button>
                                                    </UniformGrid>
                                                    <Popup
                                                        x:Name="pAddAbUps"
                                                        Width="700"
                                                        Margin="2"
                                                        AllowsTransparency="True"
                                                        Placement="MousePoint"
                                                        PopupAnimation="Scroll"
                                                        StaysOpen="True">
                                                        <Border
                                                            Background="{DynamicResource Brush1}"
                                                            BorderBrush="{DynamicResource BorderBrush}"
                                                            BorderThickness="2">
                                                            <Grid Margin="3">
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="Auto" />
                                                                    <RowDefinition Height="Auto" />
                                                                    <RowDefinition Height="*" />
                                                                    <RowDefinition Height="Auto" />
                                                                </Grid.RowDefinitions>
                                                                <TextBlock
                                                                    Margin="5"
                                                                    HorizontalAlignment="Center"
                                                                    FontWeight="Bold"
                                                                    Style="{DynamicResource TextBlock-Sketch}"
                                                                    Text="Выберите Квест" />

                                                                <ListBox
                                                                    x:Name="abUpsAimsList"
                                                                    Grid.Row="1"
                                                                    Height="400"
                                                                    Margin="2"
                                                                    DisplayMemberPath="NameOfProperty"
                                                                    ItemsSource="{Binding DataContext.AllAimsToAbUps, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                    ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                                                    Style="{DynamicResource ListBox-Sketch}" />

                                                                <UniformGrid Grid.Row="2" Rows="1">
                                                                    <Button
                                                                        Height="{StaticResource DownButtonHeight}"
                                                                        Padding="5"
                                                                        Command="{Binding DataContext.AddAbUpsAfterChooseCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                        CommandParameter="{Binding ElementName=abUpsAimsList, Path=SelectedValue}"
                                                                        Content="OK"
                                                                        Style="{StaticResource Button-Sketch}">
                                                                        <i:Interaction.Triggers>
                                                                            <i:EventTrigger EventName="Click">
                                                                                <ei:ChangePropertyAction
                                                                                    PropertyName="IsOpen"
                                                                                    TargetName="pAddAbUps"
                                                                                    Value="False" />
                                                                            </i:EventTrigger>
                                                                        </i:Interaction.Triggers>
                                                                    </Button>
                                                                    <Button
                                                                        Height="{StaticResource DownButtonHeight}"
                                                                        Padding="5"
                                                                        Content="Отмена"
                                                                        Style="{StaticResource Button-Sketch}">
                                                                        <i:Interaction.Triggers>
                                                                            <i:EventTrigger EventName="Click">
                                                                                <ei:ChangePropertyAction
                                                                                    PropertyName="IsOpen"
                                                                                    TargetName="pAddAbUps"
                                                                                    Value="False" />
                                                                            </i:EventTrigger>
                                                                        </i:Interaction.Triggers>
                                                                    </Button>
                                                                </UniformGrid>
                                                            </Grid>
                                                        </Border>
                                                    </Popup>
                                                    <TextBlock Style="{StaticResource TextBlock-SketchWrap}" Text="Квесты" />
                                                </DockPanel>
                                            </DataTemplate>
                                        </GroupBox.HeaderTemplate>
                                        <ListBox
                                            Margin="14,2,0,2"
                                            DataContext="{Binding DataContext, RelativeSource={RelativeSource AncestorType=Window}}"
                                            ItemsSource="{Binding QwUpAb}"
                                            Style="{StaticResource ListsStyle}"
                                            Visibility="{Binding QwUpAb.Count, Converter={StaticResource ItemsCountVisibilityConverter}}">
                                            <ListBox.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <WrapPanel />
                                                </ItemsPanelTemplate>
                                            </ListBox.ItemsPanel>
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <Border
                                                        Margin="1"
                                                        BorderBrush="{StaticResource BorderBrush}"
                                                        BorderThickness="1">
                                                        <Button
                                                            HorizontalContentAlignment="Stretch"
                                                            VerticalContentAlignment="Stretch"
                                                            Background="Transparent"
                                                            Command="{Binding DataContext.ShowQwestCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding QwToUp}"
                                                            Style="{StaticResource Button-Sketch}"
                                                            ToolTip="{Binding QwToUp.NameOfProperty}">
                                                            <DockPanel Margin="2">
                                                                <DockPanel
                                                                    Margin="2"
                                                                    HorizontalAlignment="Center"
                                                                    DockPanel.Dock="Right"
                                                                    LastChildFill="False">
                                                                    <TextBlock
                                                                        VerticalAlignment="Center"
                                                                        Foreground="Green"
                                                                        Style="{StaticResource TextBlock-SketchWrap}"
                                                                        Text="+" />
                                                                    <xctk:AutoSelectTextBox
                                                                        MinWidth="50"
                                                                        VerticalAlignment="Center"
                                                                        Style="{StaticResource AutoSelectTextBoxStyle}"
                                                                        Text="{Binding ValueToUp}"
                                                                        TextAlignment="Center" />
                                                                </DockPanel>
                                                                <Image
                                                                    MaxHeight="125"
                                                                    Source="{Binding QwToUp.PictureProperty}"
                                                                    Style="{StaticResource ImageStyle}" />
                                                            </DockPanel>
                                                        </Button>
                                                    </Border>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>
                                    </GroupBox>
                                </Grid>

                                <Grid Margin="0,0,0,0" DockPanel.Dock="Top">
                                    <GroupBox Header="Квесты" Style="{StaticResource myGroupBoxStyle}">
                                        <GroupBox.HeaderTemplate>
                                            <DataTemplate>
                                                <DockPanel Margin="{StaticResource MyGroupTemplMarg}">
                                                    <UniformGrid
                                                        DockPanel.Dock="Right"
                                                        Rows="1"
                                                        Visibility="{Binding DataContext.IsSetViz, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}}">
                                                        <Button
                                                            HorizontalAlignment="Right"
                                                            Background="Transparent"
                                                            Command="{Binding DataContext.AddNeedOfQwestCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            DockPanel.Dock="Top"
                                                            Style="{StaticResource ButtonAdd}"
                                                            Visibility="{Binding IsPayedProperty, Converter={StaticResource BoolToVisibilityConverter}}">
                                                            <Button.ToolTip>
                                                                <StackPanel>
                                                                    <TextBlock Text="Создать квест, связанный с навыком (ссылку)" />
                                                                </StackPanel>
                                                            </Button.ToolTip>
                                                        </Button>
                                                        <Button
                                                            HorizontalAlignment="Right"
                                                            Background="Transparent"
                                                            DockPanel.Dock="Top"
                                                            Style="{StaticResource ButtonImport}"
                                                            Visibility="{Binding IsPayedProperty, Converter={StaticResource BoolToVisibilityConverter}}">
                                                            <Button.ToolTip>
                                                                <StackPanel>
                                                                    <TextBlock Text="Выбрать квест для ссылки" />
                                                                </StackPanel>
                                                            </Button.ToolTip>
                                                            <i:Interaction.Triggers>
                                                                <i:EventTrigger EventName="Click">
                                                                    <ei:ChangePropertyAction
                                                                        PropertyName="IsOpen"
                                                                        TargetName="pAddNode"
                                                                        Value="True" />
                                                                </i:EventTrigger>
                                                            </i:Interaction.Triggers>
                                                        </Button>
                                                    </UniformGrid>
                                                    <Popup
                                                        x:Name="pAddNode"
                                                        Width="700"
                                                        Margin="2"
                                                        AllowsTransparency="True"
                                                        Placement="MousePoint"
                                                        PopupAnimation="Scroll"
                                                        StaysOpen="True">
                                                        <Border
                                                            Background="{DynamicResource Brush1}"
                                                            BorderBrush="{DynamicResource BorderBrush}"
                                                            BorderThickness="2">
                                                            <Grid Margin="3">
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="Auto" />
                                                                    <RowDefinition Height="Auto" />
                                                                    <RowDefinition Height="*" />
                                                                    <RowDefinition Height="Auto" />
                                                                </Grid.RowDefinitions>
                                                                <TextBlock
                                                                    Margin="5"
                                                                    HorizontalAlignment="Center"
                                                                    FontWeight="Bold"
                                                                    Style="{DynamicResource TextBlock-Sketch}"
                                                                    Text="Выберите Квест" />

                                                                <ListBox
                                                                    x:Name="rewAimsList"
                                                                    Grid.Row="1"
                                                                    Height="400"
                                                                    Margin="2"
                                                                    DisplayMemberPath="NameOfProperty"
                                                                    ItemsSource="{Binding DataContext.AllAimsProperty, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                    ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                                                    Style="{DynamicResource ListBox-Sketch}" />

                                                                <UniformGrid Grid.Row="2" Rows="1">
                                                                    <Button
                                                                        Height="{StaticResource DownButtonHeight}"
                                                                        Padding="5"
                                                                        Command="{Binding DataContext.AddNodeCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                        CommandParameter="{Binding ElementName=rewAimsList, Path=SelectedValue}"
                                                                        Content="OK"
                                                                        Style="{StaticResource Button-Sketch}">
                                                                        <i:Interaction.Triggers>
                                                                            <i:EventTrigger EventName="Click">
                                                                                <ei:ChangePropertyAction
                                                                                    PropertyName="IsOpen"
                                                                                    TargetName="pAddNode"
                                                                                    Value="False" />
                                                                            </i:EventTrigger>
                                                                        </i:Interaction.Triggers>
                                                                    </Button>
                                                                    <Button
                                                                        Height="{StaticResource DownButtonHeight}"
                                                                        Padding="5"
                                                                        Content="Отмена"
                                                                        Style="{StaticResource Button-Sketch}">
                                                                        <i:Interaction.Triggers>
                                                                            <i:EventTrigger EventName="Click">
                                                                                <ei:ChangePropertyAction
                                                                                    PropertyName="IsOpen"
                                                                                    TargetName="pAddNode"
                                                                                    Value="False" />
                                                                            </i:EventTrigger>
                                                                        </i:Interaction.Triggers>
                                                                    </Button>
                                                                </UniformGrid>
                                                            </Grid>
                                                        </Border>
                                                    </Popup>
                                                    <ContentControl MaxHeight="{StaticResource TaskMenuItemHeight}" Template="{StaticResource buttonLink}" />
                                                    <TextBlock Style="{StaticResource TextBlock-SketchWrap}" Text="Квесты" />
                                                </DockPanel>
                                            </DataTemplate>
                                        </GroupBox.HeaderTemplate>
                                        <Grid>

                                            <ListBox
                                                Margin="14,2,0,2"
                                                ItemsSource="{Binding LinkedQwests}"
                                                SelectedValue="{Binding DataContext.SelAbNeed, RelativeSource={RelativeSource AncestorType=Window}}"
                                                Style="{StaticResource ListsStyle}"
                                                Visibility="{Binding LinkedQwests.Count, Converter={StaticResource ItemsCountVisibilityConverter}}">
                                                <ListBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <DockPanel Background="White" Opacity="{Binding Opacity}">
                                                            <DockPanel.InputBindings>
                                                                <MouseBinding
                                                                    Command="{Binding DataContext.ShowQwestCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                    CommandParameter="{Binding}"
                                                                    Gesture="LeftDoubleClick" />
                                                            </DockPanel.InputBindings>
                                                            <UniformGrid
                                                                x:Name="subMenu"
                                                                DockPanel.Dock="Right"
                                                                Rows="1"
                                                                Visibility="Collapsed">
                                                                <!--<Button
                                                                    Background="Transparent"
                                                                    BorderBrush="Transparent"
                                                                    Command="{Binding DataContext.ShowQwestCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                    CommandParameter="{Binding}"
                                                                    Style="{StaticResource ButtonSettings}"
                                                                    ToolTip="Просмотр" />-->
                                                                <Button
                                                                    Background="Transparent"
                                                                    BorderBrush="Transparent"
                                                                    Command="{Binding DataContext.DelQwestLinkCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                    CommandParameter="{Binding}"
                                                                    Style="{StaticResource ButtonDelete}"
                                                                    ToolTip="Удаление"
                                                                    Visibility="{Binding DataContext.IsSetViz, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}}" />
                                                            </UniformGrid>

                                                            <DockPanel>
                                                                <TextBlock
                                                                    Margin="2,0,0,0"
                                                                    Style="{StaticResource TextBlock-Sketch}"
                                                                    TextAlignment="Left"
                                                                    TextDecorations="{Binding Converter={StaticResource QwestStrikeOutConverter}}"
                                                                    TextWrapping="Wrap">
                                                                    <TextBlock.Text>
                                                                        <MultiBinding Converter="{StaticResource SplitStringsConverter}">
                                                                            <Binding Path="NameOfProperty" />
                                                                        </MultiBinding>
                                                                    </TextBlock.Text>
                                                                </TextBlock>
                                                                <TextBlock
                                                                    Margin="6,0,0,0"
                                                                    VerticalAlignment="Center"
                                                                    FontSize="20"
                                                                    FontWeight="Bold"
                                                                    Foreground="Green">
                                                                    <TextBlock.Text>
                                                                        <MultiBinding Converter="{StaticResource QwestRelayToAbValueConverter}" Mode="OneWay">
                                                                            <Binding Path="DataContext.SelectedAbilitiModelProperty" RelativeSource="{RelativeSource AncestorType=Window}" />
                                                                            <Binding Path="." />
                                                                        </MultiBinding>
                                                                    </TextBlock.Text>
                                                                </TextBlock>
                                                            </DockPanel>
                                                        </DockPanel>
                                                        <DataTemplate.Triggers>
                                                            <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ListBoxItem}}, Path=IsSelected}" Value="True">
                                                                <Setter TargetName="subMenu" Property="Visibility" Value="Visible" />
                                                            </DataTrigger>
                                                        </DataTemplate.Triggers>
                                                    </DataTemplate>
                                                </ListBox.ItemTemplate>
                                            </ListBox>
                                        </Grid>
                                    </GroupBox>
                                </Grid>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>

                    <!--  EXTENDEDVERS  -->
                    <TabItem
                        DataContext="{Binding DataContext.SelectedAbilitiModelProperty, RelativeSource={RelativeSource AncestorType=Window}}"
                        Header="Требования"
                        HeaderTemplate="{StaticResource TabItemHeaderTemplate}">
                        <ScrollViewer Margin="{StaticResource ElementScrollMarg}" Style="{StaticResource EditableItemScroll}">
                            <i:Interaction.Behaviors>
                                <behavior:VerticalScrollBehavior />
                            </i:Interaction.Behaviors>
                            <StackPanel>
                                <GroupBox
                                    DockPanel.Dock="Top"
                                    Header="Мин. уровень"
                                    Style="{StaticResource myGroupBoxStyle}">
                                    <xctk:AutoSelectTextBox
                                        MinWidth="0"
                                        Margin="5,5,5,0"
                                        Style="{StaticResource PropertyAutoSellectTextBoxStyle}"
                                        Text="{Binding MinLevelProperty}" />
                                </GroupBox>
                                <GroupBox
                                    DockPanel.Dock="Top"
                                    Header="Квесты"
                                    Style="{StaticResource myGroupBoxStyle}">
                                    <GroupBox.HeaderTemplate>
                                        <DataTemplate>
                                            <DockPanel Margin="{StaticResource MyGroupTemplMarg}">
                                                <UniformGrid
                                                    DockPanel.Dock="Right"
                                                    Rows="1"
                                                    Visibility="{Binding DataContext.IsSetViz, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <Button
                                                        Background="Transparent"
                                                        Command="{Binding DataContext.AddReqAimCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                        Style="{StaticResource ButtonAdd}"
                                                        ToolTip="Создать новый квест" />
                                                    <Button
                                                        Background="Transparent"
                                                        Command="{Binding DataContext.ChooseAimReqCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                        DockPanel.Dock="Right"
                                                        Style="{StaticResource ButtonImport}"
                                                        ToolTip="Выбрать квест" />
                                                </UniformGrid>
                                                <TextBlock Style="{StaticResource TextBlock-SketchWrap}" Text="Квесты" />
                                            </DockPanel>
                                        </DataTemplate>
                                    </GroupBox.HeaderTemplate>
                                    <ListBox
                                        x:Name="lstQwReq"
                                        ItemsSource="{Binding DataContext.ReqwireAims, RelativeSource={RelativeSource AncestorType=Window}}"
                                        Style="{StaticResource ListsStyle}">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <DockPanel Background="White">
                                                    <DockPanel.InputBindings>
                                                        <MouseBinding
                                                            Command="{Binding DataContext.ShowQwestReqCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding SelectedValue, ElementName=lstQwReq}"
                                                            Gesture="LeftDoubleClick" />
                                                    </DockPanel.InputBindings>
                                                    <UniformGrid
                                                        x:Name="qwMenu"
                                                        Grid.Column="2"
                                                        DockPanel.Dock="Right"
                                                        Rows="1"
                                                        Visibility="Hidden">
                                                        <!--<Button
                                                            Command="{Binding DataContext.ShowQwestReqCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding SelectedValue, ElementName=lstQwReq}"
                                                            DockPanel.Dock="Right"
                                                            Style="{StaticResource ButtonSettings}"
                                                            ToolTip="Просмотр" />-->
                                                        <Button
                                                            Command="{Binding DataContext.DelQwReqCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding SelectedValue, ElementName=lstQwReq}"
                                                            DockPanel.Dock="Right"
                                                            Style="{StaticResource ButtonDelete}"
                                                            ToolTip="Удаление" />
                                                    </UniformGrid>
                                                    <TextBlock Style="{StaticResource TextBlock-SketchWrap}" Text="{Binding NameOfProperty}" />
                                                </DockPanel>
                                                <DataTemplate.Triggers>
                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ListBoxItem}}, Path=IsSelected}" Value="True">
                                                        <Setter TargetName="qwMenu" Property="Visibility" Value="Visible" />
                                                    </DataTrigger>
                                                </DataTemplate.Triggers>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </GroupBox>

                                <sample:ucRevardNeedAbilityView DataContext="{Binding DataContext.NeedAbilitiesDataContext, RelativeSource={RelativeSource AncestorType=Window}}" />

                                <view:ucAddCharactNeedView DataContext="{Binding DataContext.NeedChaDataContext, RelativeSource={RelativeSource AncestorType=Window}}" />
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>
                    <TabItem Header="Награды" HeaderTemplate="{StaticResource TabItemHeaderTemplate}">
                        <view:ucItemRevardsView DataContext="{Binding DataContext.ucItemRevardsViewModel, RelativeSource={RelativeSource AncestorType=Window}}" />
                    </TabItem>
                </TabControl>
            </Grid>
            <Grid Grid.Row="2" Height="{StaticResource DownButtonHeight}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Button
                    Width="100"
                    Background="{StaticResource TopBrush}"
                    Command="{Binding PrevNextCommand}"
                    CommandParameter="prev"
                    Content="&lt;&lt;"
                    Foreground="White"
                    Style="{StaticResource Button-Sketch}"
                    ToolTip="Предыдущий навык"
                    Visibility="{Binding Visibility, ElementName=btnOk}" />
                <UniformGrid
                    Grid.Column="1"
                    Height="{StaticResource DownButtonHeight}"
                    Rows="1">
                    <Button
                        x:Name="btnAddAbility"
                        Background="{StaticResource TopBrush}"
                        Click="close"
                        Command="{Binding OkCommand}"
                        CommandParameter="добавление"
                        Content="Добавить"
                        Foreground="White"
                        Style="{StaticResource Button-Sketch}" />
                    <Button
                        x:Name="btnCansel"
                        Background="{StaticResource TopBrush}"
                        Click="close"
                        Command="{Binding CanselCommand}"
                        Content="Отмена"
                        Foreground="White"
                        Style="{StaticResource Button-Sketch}" />
                    <Button
                        x:Name="btnOk"
                        Background="{StaticResource TopBrush}"
                        Click="close"
                        Command="{Binding OkCommand}"
                        Content="ОК"
                        Foreground="White"
                        Style="{StaticResource Button-Sketch}" />
                </UniformGrid>

                <Button
                    Grid.Column="2"
                    Width="100"
                    Background="{StaticResource TopBrush}"
                    Command="{Binding PrevNextCommand}"
                    CommandParameter="next"
                    Content="&gt;&gt;"
                    Foreground="White"
                    Style="{StaticResource Button-Sketch}"
                    ToolTip="Следующий навык"
                    Visibility="{Binding Visibility, ElementName=btnOk}" />
            </Grid>
        </Grid>
    </Border>
</Window>